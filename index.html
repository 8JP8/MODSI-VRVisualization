<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MODSiVR - VR Data Visualization</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="modsi-logo.svg">
    <link rel="shortcut icon" href="favicon.ico"> <!-- Assuming favicon.ico is in the root -->
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="MODSiVR - VR Data Visualization" />
    <meta property="og:description" content="Immersive VR data visualization platform using A-Frame and BabiaXR for interactive 3D charts and analytics" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://i.postimg.cc/MHXbGFv3/modsi.png" />
    <meta property="og:url" content="https://github.com/your-username/your-repo-name" />
    <meta property="og:site_name" content="MODSiVR" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="MODSiVR - VR Data Visualization" />
    <meta name="twitter:description" content="Immersive VR data visualization platform using A-Frame and BabiaXR for interactive 3D charts and analytics" />
    <meta name="twitter:image" content="https://i.postimg.cc/MHXbGFv3/modsi.png" />
    
    <!-- Additional Meta Tags -->
    <meta name="description" content="MODSiVR - Immersive VR data visualization platform using A-Frame and BabiaXR for interactive 3D charts and analytics">
    <meta name="keywords" content="VR, data visualization, A-Frame, BabiaXR, 3D charts, immersive analytics, virtual reality, AR, augmented reality">
    <meta name="author" content="MODSiVR Team">

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- A-Frame Extras (Needed for ar-hit-test) -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>
    
    <!-- Environment Component -->
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    
    <!-- Text Geometry -->
    <script src="https://unpkg.com/aframe-text-geometry-component@0.5.1/dist/aframe-text-geometry-component.min.js"></script>
    
    <!-- Babia Components -->
    <script src="https://cdn.jsdelivr.net/gh/babiaxr/aframe-babia-components@master/dist/aframe-babia-components.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/babiaxr/aframe-babia-ui@master/dist/aframe-babia-ui.min.js"></script>
    
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- AR UI elements container -->
    <div id="arUiContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5;">
        <!-- AR Placement Instructions -->
        <div class="ar-instructions hidden" id="arPlacementInstructions" style="background: rgba(0,0,0,0.75); color: white; padding: 15px 20px; text-align: center; position: absolute; top: 20px; left: 50%; transform: translateX(-50%); border-radius: 8px; pointer-events: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.5); font-size: 0.9rem;">
            <p style="margin: 0;"><strong>AR Mode:</strong> Move your phone to scan the area. <br> Tap on a detected flat surface to place the charts.</p>
        </div>

        <!-- AR Scale Slider -->
        <div id="arScaleSliderContainer" class="hidden" style="position: absolute; bottom: 90px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.75); padding: 15px; border-radius: 8px; pointer-events: auto; width: 80%; max-width: 300px; box-shadow: 0 2px 10px rgba(0,0,0,0.5);">
            <label for="arScaleSlider" style="color: white; display: block; margin-bottom: 8px; text-align: center; font-size: 0.9rem; font-weight: 500;">Chart Scale</label>
            <input type="range" id="arScaleSlider" min="0.01" max="0.3" step="0.005" value="0.05" style="width: 100%; accent-color: #2CB6F6;">
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <!-- ... existing loading content ... -->
    </div>

    <!-- Error Overlay -->
    <div class="error-overlay" id="errorOverlay">
        <!-- ... existing error content ... -->
    </div>

    <!-- NOTE: Removed original AR Mode Instructions div as we use arPlacementInstructions now -->

    <a-scene 
        background="color: #ECECEC" 
        vr-mode-ui="enabled: true" 
        ar-mode-ui="enabled: true" <!-- This A-Frame button will trigger WebXR AR mode -->
        webxr="optionalFeatures: hit-test, local-floor, dom-overlay; overlayElement: #arUiContainer;"
        renderer="logarithmic-depth-buffer: true; precision: medium;"
        embedded
        id="scene">
        <!-- Note: Removed arjs attribute to avoid conflict with WebXR hit-test.
             If marker support (from AR.js) is critical and needs to coexist,
             it would require more complex conditional logic. For now, focusing on WebXR plane detection.
        -->
        
        <!-- Sky (will be hidden in AR mode by ARHandler) -->
        <a-sky color="#ECECEC" id="sky"></a-sky>
        
        <!-- Environment (will be hidden in AR mode by ARHandler) -->
        <a-entity environment="preset: default; groundColor: #445; groundTexture: walk;" id="environment"></a-entity>
        
        <a-assets>
            <a-asset-item id="optimerBoldFont" src="https://rawgit.com/mrdoob/three.js/dev/examples/fonts/optimer_bold.typeface.json"></a-asset-item>
        </a-assets>

        <!-- AR Reticle: Visual indicator for hit-testing, moved by ar-hit-test -->
        <a-entity id="ar-reticle"
                  ar-hit-test="enabled: false;" <!-- Enabled by ARHandler on AR enter -->
                  visible="false">
            <a-torus color="#2CB6F6" radius="0.15" radius-tubular="0.01" rotation="90 0 0" segments-tubular="12" segments-radial="8"></a-torus>
            <a-torus color="#FFFFFF" radius="0.10" radius-tubular="0.005" rotation="90 0 0" segments-tubular="12" segments-radial="8"></a-torus>
        </a-entity>

        <!-- AR Origin: Charts will be parented to this entity in AR mode. It's positioned by user tap. -->
        <a-entity id="ar-origin" visible="false"></a-entity>

        <!-- Ponto de inserção de gráficos (Original charts root) -->
        <a-entity id="charts-root"></a-entity>

        <!-- Câmera VR/Desktop (will be hidden in AR mode by ARHandler) -->
        <a-entity 
            id="vrCamera"
            movement-controls="fly: true" 
            position="-3 5 20">
            <a-entity camera look-controls wasd-controls="fly:true"></a-entity> <!-- Added wasd-controls to camera entity for fly -->
            <a-entity cursor="rayOrigin:mouse" raycaster="objects: .clickable"></a-entity> <!-- Ensure raycaster targets .clickable -->
            <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity> <!-- Ensure laser targets .clickable -->
        </a-entity>

        <!-- A-Frame automatically uses a WebXR-based camera in AR mode.
             The <a-camera id="arCamera"> from original is not strictly needed if relying on default AR camera.
             If you need specific components on the AR camera, you'd add them to the camera entity managed by A-Frame,
             often by accessing `sceneEl.camera.el`.
        -->
    </a-scene>

    <!-- Room Selector UI -->
    <div class="room-selector hidden" id="roomSelector">
        <!-- ... existing room selector content ... -->
    </div>

    <script src="scripts/ar-handler.js"></script> <!-- Load AR Handler first -->
    <script src="scripts/main.js"></script>
</body>
</html>